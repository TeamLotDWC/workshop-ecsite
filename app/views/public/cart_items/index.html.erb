<div class= "container">
  <div class= "row">
    <div class= "col-12">
      <div class='text-right'>
        <%= link_to "カートを空にする", reset_customers_cart_items_path, method: :delete, class: "btn btn-danger" %>
      </div>
      <table class='table table-hover table-inverse'>
        <thead>
          <tr>
            <th>商品名</th>
            <th>単価（税込）</th>
            <th>数量</th>
            <th>小計</th>
          </tr>
        </thead>
        <tbody>
          <% @cart_items.each do |x| %>
            <tr>
              <td><%= link_to x.item.name, item_path(x.item_id) %></td>
              <td><%= x.item.add_tax_sales_price %></td>
              <%= form_with(model: @cart_item, url: customers_cart_item_path(x.id), method: :patch, local:true) do |f|  %>
                <td class="d-inline-flex">
                  <%= f.hidden_field :item_id, value: x.item_id %>
                  <%= f.select :quantity, *[1..20], selected: x.quantity %>
                  <%= f.submit '変更', class: 'btn btn-success' %>
                </td>
              <% end %>
              <td><%= x.subtotal  %></td>
              <%= form_with(model: @cart_item, url: customers_cart_item_path(x.id), method: :delete, local:true) do |f|  %>
                <td>
                  <%= f.hidden_field :item_id, value: x.item_id %>
                  <%= f.submit '削除する', class: "btn btn-danger" %>
                </td>
              <% end %>
            </tr>
            <% @total_price +=  x.subtotal %>
          <% end %>
        </tbody>
      </table>
      <div>
        <% if @cart_items.present? %>
          <p>総計:<%= @total_price %></p>
        <% end %>
        <%= link_to "お買い物を続ける", items_path, class: "btn btn-primary" %>
        <%= link_to "情報入力に進む", new_customers_order_path, class: "btn btn-success" %>
      </div>
    </div>
  </div>
</div>
